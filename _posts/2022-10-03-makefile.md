---
title: "Python 自动化杂录"
categories: Tech
updated: 
comments: true
mathjax: false
---

## Makefile

直接看原文

- Aniket Bhattacharyea. (2021). [Makefile Tutorials and Examples to Build From](https://earthly.dev/blog/make-tutorial/)
- Aniket Bhattacharyea. (2021). [Creating a Python Makefile](https://earthly.dev/blog/python-makefile/)

<!-- more -->

一个 Makefile 由若干条 rules 组成. 每条 rule 语法如下.

```makefile
target1 [target2 ...]: [pre-req1 pre-req2 pre-req3 ...]
    [recipes
    ...]
```

下面的例子来自 [pandas](https://github.com/pandas-dev/pandas/blob/main/Makefile) (.PHONTY 和不关心的项略了).

```makefile
all: develop

develop: build
	python -m pip install --no-build-isolation -e .
	
build: clean_pyc
	python setup.py build_ext

clean_pyc:
	-find . -name '*.py[co]' -exec rm {} \;
	
clean:
	-python setup.py clean
	
lint-diff:
	git diff upstream/main --name-only -- "*.py" | xargs flake8

black:
	black .

test-scripts:
	pytest scripts
```

其中 recipes 中开头的 `-` means ignore the exit status of the command that is executed (normally, a non-zero exit status would stop that part of the build). 参考 [makefile - What do @, - and + do as prefixes to recipe lines in Make? - Stack Overflow](https://stackoverflow.com/questions/3477292/what-do-and-do-as-prefixes-to-recipe-lines-in-make)

clean_pyc 中

```shell
-exec command {} ;
```

{} is a symbolic representation of the current pathname, and the semicolon is a required delimiter indicating the end of the command.

```shell
-exec rm '{}' ';'
```

另外可参考 [`find . -name -exec rm {} \;` - 16bit](https://blog.16bit.in/a?ID=00150-9574ee2a-cc00-4785-8367-550e76ea6587)

## 其他自动化组件

TODO

- 代码风格检查: [Flake8](https://flake8.pycqa.org/en/latest/)
- 代码格式化: [Black](https://black.readthedocs.io/en/stable/)
- 测试: [pytest](https://docs.pytest.org/en/7.1.x/), [tox](https://tox.wiki/en/latest/)
- Continuous Integration: [circleci](https://circleci.com/integrations/)
- [Github actions](https://github.com/features/actions)
